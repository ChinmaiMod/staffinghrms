"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SessionHandler = void 0;
const FileStorage_1 = require("../storage/FileStorage");
const toolSchemas_1 = require("../contracts/schemas/toolSchemas");
const rules_1 = require("../validation/prompts/rules");
class SessionHandler {
    storage;
    constructor(storage) {
        this.storage = storage ?? new FileStorage_1.FileStorage();
    }
    async processSessionStart(hookData) {
        const parsedData = JSON.parse(hookData);
        const sessionStartResult = toolSchemas_1.SessionStartSchema.safeParse(parsedData);
        if (!sessionStartResult.success) {
            return;
        }
        await this.ensureInstructionsExist();
        await this.storage.clearTransientData();
    }
    async ensureInstructionsExist() {
        const existingInstructions = await this.storage.getInstructions();
        if (!existingInstructions) {
            await this.storage.saveInstructions(rules_1.RULES);
        }
    }
}
exports.SessionHandler = SessionHandler;
